{"version":3,"sources":["components/account/AccountPageLoginv22.jsx"],"names":["mapDispatchToProps","loginCustomer","addMiniCart","customerAdd","withRouter","connect","props","state","setState","useState","loading","setLoading","doHandleChange","e","value","name","target","_objectSpread","React","createElement","Fragment","Helmet","concat","theme","className","href","process","style","borderRadius","color","marginTop","marginBottom","rel","class","onSubmit","undefined","preventDefault","Promise","resolve","customerApi","login","then","res","data","status","token","code","localStorage","setItem","getMiniCart","getCustomer","JSON","stringify","type","AUTH","auth","isLogin","toast","success","history","push","removeItem","isLogout","error","toastId","htmlFor","id","onChange","placeholder","classNames"],"mappings":"2PAwJA,MAAMA,EAAqB,CACvBC,kBACAC,gBACAC,iBAEWC,sBAAWC,YAAQ,KAAML,EAAdK,EA3I1B,SAA4BC,GACxB,MAAOC,EAAOC,GAAYC,mBAAS,KAC5BC,EAASC,GAAcF,oBAAS,GAEjCG,EAAkBC,IACpB,MAAM,MAAEC,EAAK,KAAEC,GAASF,EAAEG,OAC1BR,EAAQS,wBAAC,GAAKV,GAAK,IAAE,CAACQ,GAAOD,MA2DjC,OACII,IAAAC,cAACD,IAAME,SAAQ,KACXF,IAAAC,cAACE,IAAM,KACHH,IAAAC,cAAA,sCAAAG,OAA4BC,IAAMR,QAGtCG,IAAAC,cAAA,OAAKK,UAAU,cACXN,IAAAC,cAAA,OAAKK,UAAU,aACXN,IAAAC,cAAA,OAAKK,UAAU,OACXN,IAAAC,cAAA,OAAKK,UAAU,wBACXN,IAAAC,cAAA,OAAKK,UAAU,4BACXN,IAAAC,cAAA,OAAKK,UAAU,aACXN,IAAAC,cAAA,MAAIK,UAAU,cAAa,0BAC3BN,IAAAC,cAAA,KACIM,KAAMC,+EACNC,MAAO,CAACC,aAAc,OAASC,MAAO,QAASC,UAAW,OAAQC,aAAc,QAChFP,UAAU,kCACVQ,IAAI,uBAEJd,IAAAC,cAAA,KAAGc,MAAM,uBAAyB,iBAEtCf,IAAAC,cAAA,MAAIK,UAAU,aAAY,qBAC1BN,IAAAC,cAAA,QAAMe,SA/ErBrB,SACHsB,IAANtB,GACAA,EAAEuB,iBAENzB,GAAW,GACJ,IAAI0B,QAASC,IAChBC,IAAYC,MAAMjC,GAAOkC,KAAMC,IAC3B,MAAM,KAAEC,EAAI,OAAEC,GAAWF,EACnBG,EAAQF,EACM,MAAhBC,EAAOE,MAEPC,aAAaC,QAAQ,QAASH,GAC9BE,aAAaC,QAAQ,OAAQ,QAE7BT,IAAYU,YAAYJ,GAAOJ,KAAMC,IACjC,MAAM,KAAEC,GAASD,EACjBpC,EAAMJ,YAAYyC,KAGtBJ,IAAYW,YAAYL,GAAOJ,KAAMC,IACjC,MAAM,KAAEC,GAASD,EAEjBK,aAAaC,QAAQ,WAAYG,KAAKC,UAASnC,wBAAC,GAAI0B,GAAI,IAAEE,YAE1DvC,EAAMH,YAAWc,wBAAC,GAAK0B,GAAI,IAAEE,WAE7BvC,EAAML,cAAc,CAChBoD,KAAMC,IACNC,MAAM,EACNC,SAAS,IAGbC,IAAMC,QAAQ,kBACd/C,GAAW,GACXL,EAAMqD,QAAQC,KAAK,0BAGvBjD,GAAW,GAEXoC,aAAac,WAAW,QACxBd,aAAac,WAAW,SACxBd,aAAac,WAAW,YAExBvD,EAAML,cAAc,CAChBoD,KAAMC,IACNC,MAAM,EACNO,UAAU,IAEdxD,EAAMH,YAAY,IAElBsD,IAAMM,MAAM,cAAe,CAAEC,QAAS,YAE1C1B,UA4BwBpB,IAAAC,cAAA,OAAKK,UAAU,cACXN,IAAAC,cAAA,SAAO8C,QAAQ,eAAc,SAC7B/C,IAAAC,cAAA,SACI+C,GAAG,cACHC,SAAUvD,EACVyC,KAAK,QACLtC,KAAK,QACLS,UAAU,eACV4C,YAAY,iBAGpBlD,IAAAC,cAAA,OAAKK,UAAU,cACXN,IAAAC,cAAA,SAAO8C,QAAQ,kBAAiB,cAChC/C,IAAAC,cAAA,SACI+C,GAAG,iBACHC,SAAUvD,EACVG,KAAK,WACLsC,KAAK,WACL7B,UAAU,eACV4C,YAAY,cAMpBlD,IAAAC,cAAA,UACIkC,KAAK,SACL1B,MAAO,CAACC,aAAc,OAASC,MAAO,QAASC,UAAW,OAAQC,aAAc,QAChFP,UAAW6C,IAAW,mCAAoC,CACtD,cAAe3D,KAEtB","file":"static/js/34.5532cac0.chunk.js","sourcesContent":["// react\nimport React, { useState } from \"react\";\n\n// third-party\nimport { Helmet } from \"react-helmet-async\";\nimport { withRouter } from \"react-router-dom\";\nimport classNames from \"classnames\";\n\n// data stubs\nimport theme from \"../../data/theme\";\nimport customerApi from \"../../api/customer\";\nimport { loginCustomer } from \"../../store/auth\";\nimport { customerAdd } from \"../../store/customer\";\nimport { addMiniCart } from \"../../store/mini-cart\";\nimport { toast } from \"react-toastify\";\nimport { connect } from \"react-redux\";\nimport { AUTH } from \"../../store/auth/authActionTypes\";\n\nfunction AccountPageLogin22(props) {\n    const [state, setState] = useState({});\n    const [loading, setLoading] = useState(false);\n\n    const doHandleChange = (e) => {\n        const { value, name } = e.target;\n        setState({ ...state, [name]: value });\n    };\n    const doLogin = (e) => {\n        if (e !== undefined) {\n            e.preventDefault();\n        }\n        setLoading(true);\n        return new Promise((resolve) => {\n            customerApi.login(state).then((res) => {\n                const { data, status } = res;\n                const token = data;\n                if (status.code === 200) {\n                    // Simpan token ke localStorage\n                    localStorage.setItem('token', token);\n                    localStorage.setItem('auth', 'true');\n    \n                    customerApi.getMiniCart(token).then((res) => {\n                        const { data } = res;\n                        props.addMiniCart(data);\n                    });\n    \n                    customerApi.getCustomer(token).then((res) => {\n                        const { data } = res;\n                        // Simpan data customer ke localStorage\n                        localStorage.setItem('userData', JSON.stringify({...data, token}));\n                        \n                        props.customerAdd({ ...data, token });\n                        // Kirim action dengan format yang sama seperti logout\n                        props.loginCustomer({\n                            type: AUTH,\n                            auth: true,\n                            isLogin: true // tambahkan flag untuk login\n                        });\n                        \n                        toast.success(\"Login Berhasil\");\n                        setLoading(false);\n                        props.history.push(\"/account/dashboard\");\n                    });\n                } else {\n                    setLoading(false);\n                    // Bersihkan localStorage dan state jika login gagal\n                    localStorage.removeItem('auth');\n                    localStorage.removeItem('token');\n                    localStorage.removeItem('userData');\n                    \n                    props.loginCustomer({\n                        type: AUTH,\n                        auth: false,\n                        isLogout: true\n                    });\n                    props.customerAdd({});\n                    \n                    toast.error(\"Login Gagal\", { toastId: \"logout\" });\n                }\n                resolve();\n            });\n        });\n    };\n\n    return (\n        <React.Fragment>\n            <Helmet>\n                <title>{`Login Customer â€” ${theme.name}`}</title>\n            </Helmet>\n\n            <div className=\"block mt-4\">\n                <div className=\"container\">\n                    <div className=\"row\">\n                        <div className=\"col-md-8 offset-md-2\">\n                            <div className=\"card flex-grow-1 mb-md-0\">\n                                <div className=\"card-body\">\n                                    <h4 className=\"card-title\">Masuk untuk berbelanja</h4>\n                                    <a\n                                        href={process.env.REACT_APP_URL_LOGIN}\n                                        style={{borderRadius: '10px',  color: 'white', marginTop: '10px', marginBottom: '10px'}} \n                                        className=\"btn btn-danger btn-block btn-lg\"\n                                        rel=\"noopener noreferrer\"\n                                    >\n                                        <i class=\"fas fa-sign-in-alt\"></i> Akun Dapodik\n                                    </a>\n                                    <h6 className=\"text-line\">atau masuk dengan</h6>\n                                    <form onSubmit={doLogin}>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"login-email\">Email</label>\n                                            <input\n                                                id=\"login-email\"\n                                                onChange={doHandleChange}\n                                                type=\"email\"\n                                                name=\"email\"\n                                                className=\"form-control\"\n                                                placeholder=\"Enter email\"\n                                            />\n                                        </div>\n                                        <div className=\"form-group\">\n                                            <label htmlFor=\"login-password\">Kata Sandi</label>\n                                            <input\n                                                id=\"login-password\"\n                                                onChange={doHandleChange}\n                                                name=\"password\"\n                                                type=\"password\"\n                                                className=\"form-control\"\n                                                placeholder=\"Password\"\n                                            />\n                                        </div>\n                                        {/* <AsyncAction\n                                            action={doLogin} */}\n                                        {/* render={({ run, loading }) => ( */}\n                                        <button\n                                            type=\"submit\"\n                                            style={{borderRadius: '10px',  color: 'white', marginTop: '10px', marginBottom: '10px'}} \n                                            className={classNames(\"btn btn-lg btn-block btn-primary\", {\n                                                \"btn-loading\": loading,\n                                            })}\n                                        >\n                                            Login\n                                        </button>\n                                        {/* )}\n                                        /> */}\n                                    </form>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </React.Fragment>\n    );\n}\nconst mapDispatchToProps = {\n    loginCustomer,\n    addMiniCart,\n    customerAdd,\n};\nexport default withRouter(connect(null, mapDispatchToProps)(AccountPageLogin22));\n"],"sourceRoot":""}